# Password Profiling

## Password rules

Rules for the format of passwords are documented with `password.value` and `password.contents`, following the [documentation on rules](rules.md).

## Password reset

There are several different ways a site can structure password reset. As such, most of the details around password reset are profiled using fields under another property below `password.reset`, which convey which generally-recgnized "strategy" a site uses:

### Flow

The most common kind of password reset works like this:

- The user fills out a form on a "Forgot Password" page to request an email.
- The user receives an email containing a link or code of some kind.
- The user follows that link or enters the code into a form somewhere.
- The user is presented with a form in which they set a new password.

The requesting of a new password is profiled under `password.reset.flow.request`, following "Requesting password reset" below.

The response is profiled under `password.reset.flow.response`, following "Password reset responses" below.

The form in which the user changes their password is profiled under `password.reset.flow.change.form`, following the [documentation on forms](forms.md).

Any changes to sessions that take place when the user follows the link in the password reset response are profiled under `password.reset.flow.open.sessions`, following the [documentation on session changes](sessions.md).

`password.reset.flow.open.expects` contains an array of things the password reset page expects as proof of identity before resetting the password. Right now, the only values that would ever go in this array is "origin", meaning that the IP address requesting the page must be the same as the IP address the email was requested from.

There may also be a `password.reset.flow.open.expire`, if opening the link from the response accelerates the expiration of the token. See the section on Expiration below.

After the user submits their new password, `password.reset.flow.submit` contains properties that describe what comes next.

`password.reset.flow.sumbit.sessions` describes how the user's active session and other sessions change, following the [documentation on session changes](sessions.md).

`password.reset.flow.submit.expire` profiles the expiration of the reset token on use: see the section on "Expiration" below.

`password.reset.flow.submit.destination.page` contains what kind of page the user is directed to after submitting a reset password:

- `stub`: A page that doesn't go anywhere, you're just expected to close the tab or navbar away or whatever.
- `login`: The login page.
- `settings`: The user settings page, presumably the one with password changes.
- `profile`: The public-facing profile page for the user.
- `home`: Some manner of home page for the user (if `password.reset.flow.submit.sessions.own` is `login`) or the site's root (if it's not `login`).

This assumes the user wasn't logged in before resetting their password. It's possible that a site may have a different destination when a logged-in user resets their password (particularly if `password.reset.flow.submit.sessions.own` is `unchanged` and the destination page when logged out is `login`). If this is the case, this detail may be noted in the pull request comments for the profile change, but this is a detail that is not currently incorporated into profiles.

Note that being *redirected to the login page to enter the new password* does not count as a `login` value for `sessions.own` (unless the site for some reason logs the user in *before presenting the login page*, which would make no sense) - such behavior is instead reflected with `destination.page` having a value of `login`.

### Randomization

Another mechanism for password reset, not as common as the mainstream password reset flow, is when a site allows you to request a password reset, and then emails you either a new random password, or a link to obtain a new random password. `password.reset.randomize` describes this kind of password reset.

The requesting of a new password is profiled under `password.reset.randomize.request`, following "Requesting password reset" below.

The response is profiled under `password.reset.randomize.response`, following "Password reset responses" below.

`password.reset.randomize.open.result` contains a string for whether following a link sets and sends the randomized password (`send`), or just changes the password to the already-sent password (`change`).

### Onetime

Another mechanism for password reset, not as common as the mainstream password reset flow or straightforward randomization, is a one-time password, generated by the site, that will be accepted *instead of* the password currently attached to the account (without replacing the password currently on the account). After logging in, the user may or may not be prompted to change their password.

The requesting of a one-time password is profiled under `password.reset.onetime.request`, following "Requesting password reset" below.

The response is profiled under `password.reset.onetime.response`, following "Password reset responses" below.

### Replacement

One more kind of password reset is when a site prompts for several pieces of information about the user, and then, once provided, *immediately* allows the user to replace their password, without any out-of-band involvement like an email.

The URL for performing this replacement is profiled as `password.reset.replacement.url`, following the [documentation on URLs](urls.md).

### Requesting password reset

The URL for requesting password reset is profiled as `request.url` under whatever rule level (eg `password.reset.flow`), following the [documentation on URLs](urls.md).

The form for requesting password reset is profiled as `request.form` under whatever rule level (eg `password.reset.flow`), following the [documentation on forms](forms.md).

### Password reset responses

Information about when a password reset token expires (where relevant), in terms of how long after it was sent, is profiled under the `response.expire` field.

For the response email, `response.email.sender` contains the email address that the password reset response will have as its "From" value.

`response.email.body` is an array of strings representing data the reset mechanism responds with in its email message:

- `username`: Your username on the site.
- `firstname`: A "first name" set on your profile.
- `lastname`: A "last name" set on your profile.
- `url`: a URL (possibly linked) to the page to reset the password.
- `link`: A link (without the URL visible) to reset the password.
- `code`: A token that can be typed on a page (may also be part of a link/URL) to bring you to the reset screen.
- `password`: The random password, for "password.reset.randomize" and "password.reset.onetime" methods.
- `origin`: Data identifying the source for the reset request, such as the IP address it was posted from.

### Expiration

`expire` properties contain strings that describe how soon a password reset token will expire after reaching a given step.

For example, `password.reset.flow.response.expire` may have a value of `72h` to convey that the password reset token expires three days after being sent.

A value of `now` conveys that the token expires *as soon as the step is reached*. For `password.reset.flow.open.expire`, a value of `now` implies that the form may be *submitted* to reset the token, but any attempt to *reload* the form will fail.

For `password.reset.flow.submit.expire` and `password.reset.randomize.open.expire`, this value is only included as a way of canonically stating that the token does not expire at an earlier step: if it is omitted and there is no earlier `now` value, this means that the step that triggers expiration has not been profiled, not that it is absent.

Sites where tokens *do not expire* after use, meaning that they can then be *reused* to reset the password *again*, are profiled with a value of `"unchanged"` at its last point. (Allowing token reuse like this is generally expected to be a mistake, but is also surprisingly common.)

## Password change

`passsword.change` contains information describing how the user may change their password when logged in.

The URL for chaning the user's password is profiled as `password.change.url`, following the [documentation on URLs](urls.md).

The form for chaning the user's password is profiled as `password.change.form`, following the [documentation on forms](forms.md).

## Password errata

Passwords may have descriptions for errata (as `password.errata`), following the [documentation on descriptions](descriptions.md).

## Password documentation

Profiles may have a list of URLs for pages documenting the rules around passwords (as `password.documentation`), following the [documentation on URLs](urls.md).
